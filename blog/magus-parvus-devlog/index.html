<!DOCTYPE html>
<html>
<head lang="en">
  <title>Magus Parvus Blog</title>
  <link rel="stylesheet" type="text/css" href="/styles/styles.css">
  <link rel="stylesheet" type="text/css" href="/styles/code-block.css">
  <link rel="stylesheet" type="text/css" href="../styles/styles.css">
</head>
<body>

<div class=content-container>
  <script src="/top-bar/top-bar-script.js"></script>

  <h1>Magus Parvus Devlog</h1>
  <time id="blog-date" datetime="2023-12-22">DATE</time>

  <img src="/blog/magus-parvus-devlog/showcase.jpg">

  <p>
    TODO: YT LINK

    I made a cozy little 2D top down mage game.
    You walk around the map, activating statues and killing
    enemies by casting spells.
    In this blog post, I describe my development process
    and the challanges I faced using the Bevy game engine.
  </p>

  <h2>The Game</h2>

  <p>
    The game Magus Parvus,
    which you can <a href="https://praxtube.itch.io/magus-parvus">play on itch</a>,
    is a small 2D top down game where you cast spells by typing them out.
    It's fairly short, but that's kind of the point.
    I wanted to make a very small and compact game that would teach me
    the basics of how to create a 2D top down game.
  </p>

  <p>
    In this post I will focus on the technical implementation
    and some challanges that I see that need to be addressed to make
    the development process of this kind of game more feasible.
    To get a broader understanding of the game, check out
    <a href="TODO INSERT YT LINK">my youtube video</a>.
  </p>

  <h2>Implementation in Bevy</h2>

  <p>
    The game is made in <code>bevy 0.12.1</code> and uses
    the following third party crates.
  </p>

  <ul>
    <li>
      <code>bevy_rapier2d</code> - Physics and Collisions
    </li>
    <li>
      <code>bevy_ecs_ldtk</code> - Map Loading
    </li>
    <li>
      <code>bevy_kira_audio</code> - Music and Sounds
    </li>
    <li>
      <code>bevy_asset_loader</code> - Loading assets
    </li>
    <li>
      <code>bevy_trickfilm</code> - 2D Sprite Animations
    </li>
    <li>
      <code>bevy_screen_diagnostics</code> - Debugging Diagnostics
    </li>
    <li>
      <code>noisy_bevy</code> - Noise Map (for camera shake)
    </li>
  </ul>

  <p>
  The main challange here was to get dynamic chunkloading to work
  with the <code>bevy_ecs_ldtk</code> package.
  Implementing physics and collisions with <code>bevy_rapier2d</code>
  was also a little tedious, but this is mostly because their documentation
  is somewhat broken (quite a lot of outdated href links).
  Apart from that, most of the development was concerned with implementing
  the actual features of the game.
  </p>

  <h2>Development Process</h2>

  <p>
  As this is only the second game I made in Bevy,
  there were still a lot of things I didn't know how to do
  and I had to figure them out along the way.
  That being said, I feel like I was able to make
  progress rather quickly, which I contribute to the fact that
  the workflow of the Bevy engine is just superiour to that
  of engines like Unity and Godot.
  </p>

  <h3>Map Creation with LDtk</h3>

  <p>
  I chose to create the map using the
  <a href="https://ldtk.io/">LDtk tool</a>,
  which is a feature rich 2D level creator.
  Using the <a href="https://github.com/Trouv/bevy_ecs_ldtk"><code>bevy_ecs_ldtk</code></a>
  crate, I was able to load the <code>.json</code> files generated by
  LDtk into Bevy.
  </p>

  <p>
  I wanted to implement chunkloading into the game,
  however there weren't any examples or blogs about it (at least none that I could find),
  but luckily the maintainer of the crate is really friendly.
  I <a href="https://github.com/Trouv/bevy_ecs_ldtk/issues/268">opened an issue</a>
  and he was quick to guide me on how to implement it.
  Turns out, there actually IS an example on how to implement this,
  I of course somehow managed to miss that.
  </p>

  <video width="640" height="360" controls>
    <source src="/blog/magus-parvus-devlog/chunk-loading.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <p>
  So following the example on how to load and delete level sections,
  I got a basic chunkloading system in place.
  This is actually a bit overkill for this project, but it's going to be
  very useful for future games.
  </p>

  <h3>Physics and Collisions</h3>

  <p>
  While I don't want any amazing physics in my game,
  I do need collisions and basic linear velocity.
  <a href="https://github.com/dimforge/bevy_rapier"><code>bevy_rapier2d</code></a>
  is perfect for this.
  It's pretty straightforward, however the documentation is a little broken at places,
  so I had to look through the source code for certain informations
  (which is pretty common with most of Bevy I find).
  </p>

  <p>
  The only issue I still haven't fixed here is how to handle camera movement.
  In Magus Parvus, the camera is always dead center on the player,
  at least it should. Because the player has a <code>Rigidbody</code>,
  it is controlled by Rapier, meaning I can't just set the camera position
  equal to the players position.
  I did manage to somewhat circumvent this problem by adding the current player velocity
  to the camera position, but that creates new isssues of it's own
  (when the player is walking into a wall the camera will be a little bit in front of the player).
  </p>

  <h3>Sprite Animations</h3>

  <p>
  Both of the above problems deal with the backend, which you write once
  and pretty much leave alone for the rest of the project.
  Animations on the other hand are much more problematic.
  There more content you will add to your game, the more
  your workflow of adding the content matters.
  Physics and chunkloading are independant of the content size,
  they work the same if you only have 1 enemy or 100.
  However, if your workflow of adding animations is by hardcoding
  the sprite indices then you will have a terrible time managing
  this mess for even 10 enemies, let alone 100.
  </p>

  <p>
  This is one of my major problems with Unity and Godot,
  their animation tools are really tedious to use
  (mainly because you must use the mouse, which I find super frustrating).
  Bevy's built in solution is: ... Well it doesn't have one of course.
  I found the <a href="https://github.com/KirmesBude/bevy_trickfilm"><code>bevy_trickfilm</code></a>
  crate to be quite intuitive, the API feels similar to that of Godot,
  but you define the animations inside of a <code>.ron</code> file,
  which means I don't have to use the mouse to create animations.
  The crate still needs quite a bit of work though, but that's to be expected.
  With some more work on the crate it should be much simpler to use
  sprite sheet animations in the future.
  </p>

  <h3>UI</h3>

  <p>
  The game also has UI, which is kept to a minimum as
  I already know that UI is one of the worst parts of game development.
  Despite it looks, the UI for the spell book took my a dozen hours or so to implement.
  It's fairly clean now actually, after many refactors,
  but keeping the UI to a minimum is super important.
  It also helps with keeping the game as immersive as possible,
  as UI tends to look and feel out of place, at least if not doen right,
  which is very hard.
  </p>

  <video width="640" height="360" controls>
    <source src="/blog/magus-parvus-devlog/spell-book.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <h2>Future Plans</h2>

  <p>
  My long term plan is to work on more small projects like these,
  all in the 2D top down style. The goal with each is to learn
  something new so that I can eventually work on bigger and bigger
  projects. I already have some ideas for future projects,
  so stay tuned for those.
  </p>

  <div style="height: 200px;"></div>
</div>

<script src="/blog/scripts/post-blog.js"></script>

</body>
</html>
